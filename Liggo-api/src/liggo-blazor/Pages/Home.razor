@page "/dashboard"
@inject AuthService Auth
@inject NavigationManager Nav
@inject IJSRuntime JS

<div class="space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-black text-[#0A1F44]">Panel General</h1>
            <p class="text-slate-500 font-medium">Bienvenido al centro de mando de LIGGO.</p>
        </div>
        <div class="hidden sm:block">
            <div class="flex items-center gap-2 rounded-xl bg-[#0B6623]/10 px-4 py-2 text-[#0B6623]">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-trending-up"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                <span class="text-sm font-bold uppercase tracking-wider">Rendimiento Óptimo</span>
            </div>
        </div>
    </div>

    @* KPIs con Colores de Acento e Iconos de React *@
    <div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
        <KPICard Title="Jugadores" Value="@MockData.Players.Count.ToString()" Trend="+3 este mes" Color="text-[#0B6623]">
            <Icon>
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
            </Icon>
        </KPICard>
        <KPICard Title="Equipos" Value="@MockData.Teams.Count.ToString()" Color="text-[#0A1F44]">
            <Icon>
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"/></svg>
            </Icon>
        </KPICard>
        <KPICard Title="Incidencias" Value="@MockData.Incidents.Count(i => i.Status == "activa").ToString()" Color="text-red-500">
            <Icon>
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3ZM12 9v4m0 4h.01"/></svg>
            </Icon>
        </KPICard>
        <KPICard Title="Ingresos" Value="$48,500" Trend="+12% vs mes anterior" Color="text-[#0B6623]">
            <Icon>
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
            </Icon>
        </KPICard>
    </div>

    <div class="grid gap-8 lg:grid-cols-3">
        @* Gráfica con Diseño Premium *@
        <div class="rounded-3xl border-none bg-white p-8 shadow-[0_4px_20px_rgba(0,0,0,0.05)] lg:col-span-2 transition-all hover:shadow-[0_10px_40px_rgba(0,0,0,0.06)]">
            <div class="mb-8">
                <h3 class="text-xl font-black text-[#0A1F44]">Actividad Semestral</h3>
                <p class="text-sm font-medium text-slate-400">Asistencias vs Pagos registrados</p>
            </div>
            <div class="h-[320px] w-full">
                <canvas id="dashboardChart"></canvas>
            </div>
        </div>

        @* Eventos Estilo Premium (Igual a React) *@
        <div class="rounded-3xl border-none bg-[#0A1F44] p-8 text-white shadow-[0_4px_20px_rgba(0,0,0,0.05)] transition-all hover:shadow-[0_15px_40px_rgba(0,0,0,0.1)]">
            <div class="mb-8 flex items-center gap-3">
                <div class="flex h-10 w-10 items-center justify-center rounded-xl bg-[#FFD700] text-[#0A1F44] shadow-lg shadow-[#FFD700]/20">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
                </div>
                <h3 class="text-xl font-black">Próximos Eventos</h3>
            </div>
            <div class="space-y-4">
                @foreach (var ev in MockData.UpcomingEvents)
                {
                    <div class="group flex items-center justify-between rounded-2xl bg-white/5 p-4 transition-all hover:bg-white/10 border border-white/5 hover:border-white/20 active:scale-[0.98]">
                        <div>
                            <p class="text-sm font-bold text-white group-hover:text-[#FFD700] transition-colors leading-tight">@ev.Title</p>
                            <p class="text-[11px] text-slate-400 mt-1 font-bold uppercase tracking-widest">@ev.Date</p>
                        </div>
                        <div class="scale-90">
                            <StatusBadge Status="@(ev.Type == "partido" ? "programado" : "activa")" />
                        </div>
                    </div>
                }
                <button class="mt-6 w-full rounded-2xl bg-white/10 py-4 text-xs font-black uppercase tracking-widest text-white transition-all hover:bg-white/20 active:scale-95 border border-white/5">
                    Ver calendario completo
                </button>
            </div>
        </div>
    </div>
</div>

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && Auth.IsAuthenticated)
        {
            var labels = MockData.MonthlyChartData.Select(d => d.Month).ToArray();
            var asistencias = MockData.MonthlyChartData.Select(d => d.Asistencias).ToArray();
            var pagos = MockData.MonthlyChartData.Select(d => d.Pagos).ToArray();

            await JS.InvokeVoidAsync("setupChart", "dashboardChart", labels, asistencias, pagos);
        }
    }

    protected override void OnInitialized()
    {
        if (!Auth.IsAuthenticated) Nav.NavigateTo("/login");
    }
}
